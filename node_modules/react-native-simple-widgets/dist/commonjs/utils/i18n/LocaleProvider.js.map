{"version":3,"sources":["LocaleProvider.tsx"],"names":["LocaleProviderCtx","React","createContext","defaultLocale","currentLocale","polyglot","Polyglot","locale","phrases","defaultPhrases","en","setCurrentLocale","setPolyglot","newPolyglot","translate","key","option","t","getCurrentLocale","LocaleProvider","Component","isInit","fetchLocaleJson","props","then","result","ok","data","setState","setDefaultPolyglot","catch","componentDidMount","updatePolyglot","componentDidUpdate","prevProps","isFilterInitChanged","isLocaleChanged","render","children"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport Polyglot from \"node-polyglot\";\r\nimport defaultPhrases from \"./locales\";\r\n\r\nexport const LocaleProviderCtx = React.createContext<Polyglot>({});\r\n\r\nconst defaultLocale = \"en\";\r\nlet currentLocale = defaultLocale;\r\nlet polyglot = new Polyglot({\r\n    locale: currentLocale,\r\n    phrases: defaultPhrases.en,\r\n});\r\n\r\nexport const setCurrentLocale = locale => {\r\n    currentLocale = locale;\r\n};\r\n\r\nexport const setPolyglot = newPolyglot => {\r\n    polyglot = newPolyglot;\r\n};\r\n\r\nexport const translate = (key, option = {}) => {\r\n    return polyglot ? polyglot.t(key, option) : key;\r\n};\r\n\r\nexport const getCurrentLocale = () => currentLocale;\r\n\r\ntype Props = {\r\n    children: React.ReactNode,\r\n    locale?: string,\r\n    isInit: boolean,\r\n    loadingComponent?: React.ReactNode,\r\n    fetchLocaleJson: () => Promise<any>,\r\n};\r\n\r\nclass LocaleProvider extends React.Component<Props> {\r\n\r\n    state = {\r\n        polyglot,\r\n    };\r\n\r\n    componentDidMount() {\r\n        this.updatePolyglot();\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n        const isFilterInitChanged = prevProps.isInit !== this.props.isInit;\r\n        const isLocaleChanged = prevProps.locale !== this.props.locale;\r\n\r\n        if (this.props.isInit && (isFilterInitChanged || isLocaleChanged)) {\r\n            this.updatePolyglot();\r\n        }\r\n    }\r\n\r\n    updatePolyglot = () => {\r\n        const { locale = \"en\", isInit, fetchLocaleJson } = this.props;\r\n        if (!isInit) return;\r\n\r\n        if (typeof fetchLocaleJson === \"function\") {\r\n            fetchLocaleJson()\r\n                .then(result => {\r\n                    if (result.ok) {\r\n                        setCurrentLocale(locale);\r\n                        polyglot = new Polyglot({\r\n                            locale: locale,\r\n                            phrases: result.data,\r\n                        });\r\n                        this.setState({\r\n                            polyglot,\r\n                        });\r\n                    } else {\r\n                        this.setDefaultPolyglot();\r\n                    }\r\n                })\r\n                .catch(() => {\r\n                    this.setDefaultPolyglot();\r\n                });\r\n        }\r\n    };\r\n\r\n    setDefaultPolyglot = () => {\r\n        setCurrentLocale(defaultLocale);\r\n        polyglot = new Polyglot({\r\n            locale: defaultLocale,\r\n            phrases: defaultPhrases.en,\r\n        });\r\n        this.setState({\r\n            polyglot,\r\n        });\r\n    };\r\n\r\n    render() {\r\n        const { children } = this.props;\r\n\r\n        return (\r\n            <LocaleProviderCtx.Provider value={polyglot}>\r\n                {children}\r\n            </LocaleProviderCtx.Provider>\r\n        );\r\n    }\r\n}\r\n\r\nexport default LocaleProvider;\r\n"]}