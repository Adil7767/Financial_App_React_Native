{"version":3,"sources":["index.tsx"],"names":["ViewTransformer","React","Component","constructor","props","scale","translateX","translateY","animator","Animated","Value","width","height","pageX","pageY","_viewPortRect","Rect","onLayout","bind","cancelAnimation","contentRect","transformedContentRect","animate","onResponderGrant","gestureResponder","onStartShouldSetResponder","evt","gestureState","onMoveShouldSetResponderCapture","onResponderMove","onResponderRelease","onResponderTerminate","onResponderTerminationRequest","onResponderSingleTapConfirmed","onSingleTapConfirmed","scroller","Scroller","dx","dy","isFinished","animateBounce","updateTransform","state","viewPortRect","set","rect","copy","contentAspectRatio","currentTransform","Transform","UNSAFE_componentWillMount","componentDidUpdate","prevProps","prevState","onViewTransformed","componentWillUnmount","render","enableTransform","el","innerViewRef","flex","transform","children","e","nativeEvent","layout","setState","measureLayout","handle","ReactNative","findNodeHandle","NativeModules","UIManager","measure","x","y","onTransformStart","responderGranted","moveX","previousMoveX","moveY","previousMoveY","enableResistance","d","applyResistance","enableTranslate","previousPinch","pinch","enableScale","scaleBy","pivotX","pivotY","Math","abs","handled","onTransformGestureReleased","doubleTapUp","x0","y0","performDoubleTapUp","performFling","vx","vy","startX","startY","maxX","minX","maxY","minY","availablePanDistance","left","maxOverScrollDistance","right","top","bottom","fling","curScale","maxScale","centerX","centerY","stopAnimation","targetRect","durationInMillis","duration","fromRect","equals","removeAllListeners","setValue","addListener","progress","value","timing","toValue","useNativeDriver","easing","Easing","inOut","ease","start","minScale","forceUpdateTransform","getAvailableTranslateSpace","getTransform"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport ReactNative, { View, Animated, Easing, NativeModules } from \"react-native\";\nimport Scroller from \"../Scroller\";\nimport { createResponder } from \"../GestureResponder\";\nimport { Rect, Transform, transformedRect, availableTranslateSpace, fitCenterRect, alignedRect, getTransform } from \"./TransformUtils\";\n\ntype Props = {\n    enableTransform?: boolean,\n    enableScale?: boolean,\n    enableTranslate?: boolean,\n    maxOverScrollDistance?: number,\n    maxScale?: number,\n    contentAspectRatio?: number,\n    enableResistance?: boolean,\n    onViewTransformed?: (evt?) => void,\n    onTransformGestureReleased?: (evt?) => void,\n    onSingleTapConfirmed?: (evt?) => void,\n    onLayout?: (evt?) => void,\n    onTransformStart?: (evt?) => void,\n    children?: React.ReactNode,\n};\n\ntype State = {\n    scale?: number,\n    translateX?: number,\n    translateY?: number,\n    // animation state\n    animator?: Animated.Value,\n    // layout\n    width?: number,\n    height?: number,\n    pageX?: number,\n    pageY?: number,\n    responderGranted?: boolean,\n};\n\nexport default class ViewTransformer extends React.Component<Props, State> {\n\n    static Rect = Rect;\n    static getTransform = getTransform;\n\n    static defaultProps = {\n        maxOverScrollDistance: 20,\n        enableScale: true,\n        enableTranslate: true,\n        enableTransform: true,\n        maxScale: 1,\n        enableResistance: false\n    };\n\n    state: State = {\n        // transform state\n        scale: 1,\n        translateX: 0,\n        translateY: 0,\n        // animation state\n        animator: new Animated.Value(0),\n        // layout\n        width: 0,\n        height: 0,\n        pageX: 0,\n        pageY: 0\n    };\n\n    _viewPortRect;\n    scroller;\n\n    gestureResponder;\n\n    innerViewRef;\n\n    constructor (props) {\n        super(props);\n\n        this._viewPortRect = new Rect(); // A holder to avoid new too much\n\n        this.onLayout = this.onLayout.bind(this);\n        this.cancelAnimation = this.cancelAnimation.bind(this);\n        this.contentRect = this.contentRect.bind(this);\n        this.transformedContentRect = this.transformedContentRect.bind(this);\n        this.animate = this.animate.bind(this);\n        this.onResponderGrant = this.onResponderGrant.bind(this);\n\n        this.gestureResponder = createResponder({\n            onStartShouldSetResponder: (evt, gestureState) => true,\n            onMoveShouldSetResponderCapture: (evt, gestureState) => true,\n            // onMoveShouldSetResponder: this.handleMove,\n            onResponderMove: this.onResponderMove,\n            onResponderGrant: this.onResponderGrant,\n            onResponderRelease: this.onResponderRelease,\n            onResponderTerminate: this.onResponderRelease,\n            onResponderTerminationRequest: (evt, gestureState) => false, // Do not allow parent view to intercept gesture\n            onResponderSingleTapConfirmed: (evt, gestureState) => {\n                this.props.onSingleTapConfirmed && this.props.onSingleTapConfirmed();\n            }\n        });\n\n        this.scroller = new Scroller(true, (dx, dy, scroller) => {\n            if (dx === 0 && dy === 0 && scroller.isFinished()) {\n                this.animateBounce();\n                return;\n            }\n\n            this.updateTransform({\n                translateX: this.state.translateX + dx / this.state.scale,\n                translateY: this.state.translateY + dy / this.state.scale\n            });\n        });\n    }\n\n    viewPortRect () {\n        this._viewPortRect.set(0, 0, this.state.width, this.state.height);\n        return this._viewPortRect;\n    }\n\n    contentRect () {\n        let rect = this.viewPortRect().copy();\n        if (this.props.contentAspectRatio && this.props.contentAspectRatio > 0) {\n            rect = fitCenterRect(this.props.contentAspectRatio, rect);\n        }\n        return rect;\n    }\n\n    transformedContentRect () {\n        let rect = transformedRect(this.viewPortRect(), this.currentTransform());\n        if (this.props.contentAspectRatio && this.props.contentAspectRatio > 0) {\n            rect = fitCenterRect(this.props.contentAspectRatio, rect);\n        }\n        return rect;\n    }\n\n    currentTransform () {\n        return new Transform(this.state.scale, this.state.translateX, this.state.translateY);\n    }\n\n    UNSAFE_componentWillMount () {\n        // this.gestureResponder = createResponder({\n        //     onStartShouldSetResponder: (evt, gestureState) => true,\n        //     onMoveShouldSetResponderCapture: (evt, gestureState) => true,\n        //     // onMoveShouldSetResponder: this.handleMove,\n        //     onResponderMove: this.onResponderMove,\n        //     onResponderGrant: this.onResponderGrant,\n        //     onResponderRelease: this.onResponderRelease,\n        //     onResponderTerminate: this.onResponderRelease,\n        //     onResponderTerminationRequest: (evt, gestureState) => false, // Do not allow parent view to intercept gesture\n        //     onResponderSingleTapConfirmed: (evt, gestureState) => {\n        //         this.props.onSingleTapConfirmed && this.props.onSingleTapConfirmed();\n        //     }\n        // });\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        this.props.onViewTransformed && this.props.onViewTransformed({\n            scale: this.state.scale,\n            translateX: this.state.translateX,\n            translateY: this.state.translateY\n        });\n    }\n\n    componentWillUnmount () {\n        this.cancelAnimation();\n    }\n\n    render () {\n        let gestureResponder = this.gestureResponder;\n        if (!this.props.enableTransform) {\n            gestureResponder = {};\n        }\n\n        return (\n            <View\n                {...this.props}\n                {...gestureResponder}\n                //   ref={'innerViewRef'}\n                ref={(el) => {\n                    this.innerViewRef = el;\n                }}\n                onLayout={this.onLayout}>\n                <View\n                    style={{\n                        flex: 1,\n                        transform: [\n                            { scale: this.state.scale },\n                            { translateX: this.state.translateX },\n                            { translateY: this.state.translateY }\n                        ]\n                    }}>\n                    { this.props.children }\n                </View>\n            </View>\n        );\n    }\n\n    onLayout (e) {\n        const {width, height} = e.nativeEvent.layout;\n        if (width !== this.state.width || height !== this.state.height) {\n            this.setState({width, height});\n        }\n        this.measureLayout();\n\n        this.props.onLayout && this.props.onLayout(e);\n    }\n\n    measureLayout () {\n        // let handle = ReactNative.findNodeHandle(this.refs['innerViewRef']);\n        const handle = ReactNative.findNodeHandle(this.innerViewRef);\n        NativeModules.UIManager.measure(handle, (x, y, width, height, pageX, pageY) => {\n            if (typeof pageX === \"number\" && typeof pageY === \"number\") { // avoid undefined values on Android devices\n                if (this.state.pageX !== pageX || this.state.pageY !== pageY) {\n                    this.setState({ pageX: pageX, pageY: pageY });\n                }\n            }\n        });\n    }\n\n    onResponderGrant (evt, gestureState) {\n        this.props.onTransformStart && this.props.onTransformStart();\n        this.setState({responderGranted: true});\n        this.measureLayout();\n    }\n\n    onResponderMove (evt, gestureState) {\n        this.cancelAnimation();\n\n        let dx = gestureState.moveX - gestureState.previousMoveX;\n        let dy = gestureState.moveY - gestureState.previousMoveY;\n        if (this.props.enableResistance) {\n            const d = this.applyResistance(dx, dy);\n            dx = d.dx;\n            dy = d.dy;\n        }\n\n        if (!this.props.enableTranslate) {\n            dx = dy = 0;\n        }\n\n        let transform: any = {};\n        if (gestureState.previousPinch && gestureState.pinch && this.props.enableScale) {\n            const scaleBy = gestureState.pinch / gestureState.previousPinch;\n            const pivotX = gestureState.moveX - this.state.pageX;\n            const pivotY = gestureState.moveY - this.state.pageY;\n\n            const rect = transformedRect(\n                transformedRect(\n                    this.contentRect(),\n                    this.currentTransform()\n                ),\n                new Transform(scaleBy, dx, dy, { x: pivotX, y: pivotY })\n            );\n            transform = getTransform(this.contentRect(), rect);\n        } else {\n            if (Math.abs(dx) > 2 * Math.abs(dy)) {\n                dy = 0;\n            } else if (Math.abs(dy) > 2 * Math.abs(dx)) {\n                dx = 0;\n            }\n            transform.translateX = this.state.translateX + dx / this.state.scale;\n            transform.translateY = this.state.translateY + dy / this.state.scale;\n        }\n\n        this.updateTransform(transform);\n        return true;\n    }\n\n    onResponderRelease (evt, gestureState) {\n        const handled: any = this.props.onTransformGestureReleased && this.props.onTransformGestureReleased({\n            scale: this.state.scale,\n            translateX: this.state.translateX,\n            translateY: this.state.translateY\n        });\n        if (handled) {\n            return;\n        }\n\n        if (gestureState.doubleTapUp) {\n            if (!this.props.enableScale) {\n                this.animateBounce();\n                return;\n            }\n            let pivotX = 0;\n            let pivotY = 0;\n            if (gestureState.dx || gestureState.dy) {\n                pivotX = gestureState.moveX - this.state.pageX;\n                pivotY = gestureState.moveY - this.state.pageY;\n            } else {\n                pivotX = gestureState.x0 - this.state.pageX;\n                pivotY = gestureState.y0 - this.state.pageY;\n            }\n\n            this.performDoubleTapUp(pivotX, pivotY);\n        } else {\n            if (this.props.enableTranslate) {\n                this.performFling(gestureState.vx, gestureState.vy);\n            } else {\n                this.animateBounce();\n            }\n        }\n    }\n\n    performFling (vx, vy) {\n        const startX = 0;\n        const startY = 0;\n        let maxX, minX, maxY, minY;\n        const availablePanDistance = availableTranslateSpace(this.transformedContentRect(), this.viewPortRect());\n        if (vx > 0) {\n            minX = 0;\n            if (availablePanDistance.left > 0) {\n                maxX = availablePanDistance.left + this.props.maxOverScrollDistance;\n            } else {\n                maxX = 0;\n            }\n        } else {\n            maxX = 0;\n            if (availablePanDistance.right > 0) {\n                minX = -availablePanDistance.right - this.props.maxOverScrollDistance;\n            } else {\n                minX = 0;\n            }\n        }\n        if (vy > 0) {\n            minY = 0;\n            if (availablePanDistance.top > 0) {\n                maxY = availablePanDistance.top + this.props.maxOverScrollDistance;\n            } else {\n                maxY = 0;\n            }\n        } else {\n            maxY = 0;\n            if (availablePanDistance.bottom > 0) {\n                minY = -availablePanDistance.bottom - this.props.maxOverScrollDistance;\n            } else {\n                minY = 0;\n            }\n        }\n\n        vx *= 1000; // per second\n        vy *= 1000;\n        if (Math.abs(vx) > 2 * Math.abs(vy)) {\n            vy = 0;\n        } else if (Math.abs(vy) > 2 * Math.abs(vx)) {\n            vx = 0;\n        }\n\n        this.scroller.fling(startX, startY, vx, vy, minX, maxX, minY, maxY);\n    }\n\n    performDoubleTapUp (pivotX, pivotY) {\n        const curScale = this.state.scale;\n        let scaleBy;\n        if (curScale > (1 + this.props.maxScale) / 2) {\n            scaleBy = 1 / curScale;\n        } else {\n            scaleBy = this.props.maxScale / curScale;\n        }\n\n        let rect = transformedRect(\n            this.transformedContentRect(),\n            new Transform(scaleBy, 0, 0, { x: pivotX, y: pivotY })\n        );\n        rect = transformedRect(\n            rect,\n            new Transform(\n                1,\n                this.viewPortRect().centerX() - pivotX,\n                this.viewPortRect().centerY() - pivotY\n            )\n        );\n        rect = alignedRect(rect, this.viewPortRect());\n        this.animate(rect);\n    }\n\n    applyResistance (dx, dy) {\n        const availablePanDistance = availableTranslateSpace(this.transformedContentRect(), this.viewPortRect());\n\n        if ((dx > 0 && availablePanDistance.left < 0) ||\n        (dx < 0 && availablePanDistance.right < 0)) {\n            dx /= 3;\n        }\n        if ((dy > 0 && availablePanDistance.top < 0) ||\n        (dy < 0 && availablePanDistance.bottom < 0)) {\n            dy /= 3;\n        }\n        return { dx, dy };\n    }\n\n    cancelAnimation () {\n        this.state.animator.stopAnimation();\n    }\n\n    animate (targetRect, durationInMillis?) {\n        let duration = 200;\n        if (durationInMillis) {\n            duration = durationInMillis;\n        }\n\n        const fromRect = this.transformedContentRect();\n        if (fromRect.equals(targetRect, 0.01)) {\n            return;\n        }\n\n        this.state.animator.removeAllListeners();\n        this.state.animator.setValue(0);\n        this.state.animator.addListener((state) => {\n            const progress = state.value;\n\n            const left = fromRect.left + (targetRect.left - fromRect.left) * progress;\n            const right = fromRect.right + (targetRect.right - fromRect.right) * progress;\n            const top = fromRect.top + (targetRect.top - fromRect.top) * progress;\n            const bottom = fromRect.bottom + (targetRect.bottom - fromRect.bottom) * progress;\n\n            const transform = getTransform(this.contentRect(), new Rect(left, top, right, bottom));\n            this.updateTransform(transform);\n        });\n\n        Animated.timing(\n            this.state.animator,\n            {\n                toValue: 1,\n                duration: duration,\n                useNativeDriver: false,\n                easing: Easing.inOut(Easing.ease),\n            }\n        ).start();\n    }\n\n    animateBounce () {\n        const curScale = this.state.scale;\n        const minScale = 1;\n        const maxScale = this.props.maxScale;\n        let scaleBy = 1;\n        if (curScale > maxScale) {\n            scaleBy = maxScale / curScale;\n        } else if (curScale < minScale) {\n            scaleBy = minScale / curScale;\n        }\n\n        let rect = transformedRect(\n            this.transformedContentRect(),\n            new Transform(\n                scaleBy,\n                0,\n                0,\n                {\n                    x: this.viewPortRect().centerX(),\n                    y: this.viewPortRect().centerY()\n                }\n            )\n        );\n        rect = alignedRect(rect, this.viewPortRect());\n        this.animate(rect);\n    }\n\n    updateTransform (transform) {\n        this.setState(transform);\n    }\n\n    forceUpdateTransform (transform) {\n        this.setState(transform);\n    }\n\n    getAvailableTranslateSpace () {\n        return availableTranslateSpace(this.transformedContentRect(), this.viewPortRect());\n    }\n}\n"]}