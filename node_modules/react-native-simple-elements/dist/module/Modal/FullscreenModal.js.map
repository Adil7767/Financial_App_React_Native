{"version":3,"sources":["FullscreenModal.tsx"],"names":["React","View","KeyboardAvoidingView","Modal","RNModal","Animated","PanResponder","Dimensions","Platform","WindowHeight","get","height","SUPPORTED_ORIENTATIONS","defaultProps","animationType","minClosingHeight","openDuration","closeDuration","closeOnDragDown","dragFromTopOnly","closeOnPressMask","closeOnPressBack","keyboardAvoidingViewEnabled","OS","customStyles","onClose","onOpen","children","FullscreenModal","visible","modalVisible","setModalVisible","useState","pan","useRef","ValueXY","panResponder","undefined","useEffect","_setModalVisible","props","createPanResponder","current","create","onStartShouldSetPanResponder","onPanResponderMove","e","gestureState","dy","event","y","useNativeDriver","onPanResponderRelease","spring","toValue","x","start","panStyle","transform","getTranslateTransform","flex","backgroundColor","wrapper","panHandlers","width","overflow","container","alignItems","borderRadius","margin","draggableIcon"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport {\r\n    View,\r\n    KeyboardAvoidingView,\r\n    Modal as RNModal,\r\n    Animated,\r\n    PanResponder,\r\n    Dimensions,\r\n    Platform\r\n} from \"react-native\";\r\n\r\nconst WindowHeight = Dimensions.get(\"window\").height;\r\n\r\nconst SUPPORTED_ORIENTATIONS = [\r\n    \"portrait\",\r\n    \"portrait-upside-down\",\r\n    \"landscape\",\r\n    \"landscape-left\",\r\n    \"landscape-right\"\r\n];\r\n\r\ntype Props = {\r\n    animationType?: \"none\" | \"slide\" | \"fade\",\r\n    visible: boolean,\r\n    height?: number,\r\n    minClosingHeight?: number,\r\n    openDuration?: number,\r\n    closeDuration?: number,\r\n    closeOnDragDown?: boolean,\r\n    closeOnPressMask?: boolean,\r\n    dragFromTopOnly?: boolean,\r\n    closeOnPressBack?: boolean,\r\n    keyboardAvoidingViewEnabled?: boolean,\r\n    customStyles?: Record<string, unknown>,\r\n    onClose?: (evt) => void,\r\n    onOpen?: (evt) => void,\r\n    children?: React.ReactNode,\r\n};\r\n\r\n// type State = {\r\n//     animatedHeight: Animated.Value,\r\n//     pan: Animated.ValueXY,\r\n//     modalVisible: boolean,\r\n// }\r\n\r\nconst defaultProps = {\r\n    animationType: \"none\",\r\n    height: WindowHeight,\r\n    minClosingHeight: 0,\r\n    openDuration: 300,\r\n    closeDuration: 200,\r\n    closeOnDragDown: false,\r\n    dragFromTopOnly: false,\r\n    closeOnPressMask: true,\r\n    closeOnPressBack: true,\r\n    keyboardAvoidingViewEnabled: Platform.OS === \"ios\",\r\n    customStyles: {},\r\n    onClose: null,\r\n    onOpen: null,\r\n    children: <View />\r\n};\r\n\r\nconst FullscreenModal = ({\r\n    visible,\r\n    animationType,\r\n    closeOnDragDown,\r\n    dragFromTopOnly,\r\n    closeOnPressBack,\r\n    children,\r\n    customStyles,\r\n    keyboardAvoidingViewEnabled,\r\n    height,\r\n    onOpen,\r\n    onClose,\r\n}: Props) => {\r\n\r\n    const [ modalVisible, setModalVisible ] = React.useState(false);\r\n    const pan = React.useRef(new Animated.ValueXY());\r\n\r\n    const panResponder = React.useRef(undefined);\r\n\r\n    React.useEffect(() => {\r\n        if (!modalVisible && visible) {\r\n            _setModalVisible(true);\r\n        } else if (modalVisible && !visible) {\r\n            _setModalVisible(false);\r\n        }\r\n    }, [ visible ]);\r\n\r\n    const _setModalVisible = (visible, props?) => {\r\n        if (visible) {\r\n            setModalVisible(visible);\r\n            if (typeof onOpen === \"function\") onOpen(props);\r\n        } else {\r\n            setModalVisible(visible);\r\n            if (typeof onClose === \"function\") onClose(props);\r\n        }\r\n    };\r\n\r\n    const createPanResponder = () => {\r\n        panResponder.current = PanResponder.create({\r\n            onStartShouldSetPanResponder: () => closeOnDragDown,\r\n            onPanResponderMove: (e, gestureState) => {\r\n                if (gestureState.dy > 0) {\r\n                    Animated.event([null, { dy: pan.current.y }], { useNativeDriver: false })(e, gestureState);\r\n                }\r\n            },\r\n            onPanResponderRelease: (e, gestureState) => {\r\n                if (height / 4 - gestureState.dy < 0) {\r\n                    _setModalVisible(false);\r\n                } else {\r\n                    Animated.spring(pan.current, { toValue: { x: 0, y: 0 }, useNativeDriver: false }).start();\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    if (!visible && !panResponder.current) {\r\n        createPanResponder();\r\n    }\r\n\r\n    const panStyle = {\r\n        transform: pan.current.getTranslateTransform()\r\n    };\r\n\r\n    return (\r\n        <RNModal\r\n            transparent\r\n            animationType={animationType}\r\n            visible={modalVisible}\r\n            // @ts-ignore\r\n            supportedOrientations={SUPPORTED_ORIENTATIONS}\r\n            onRequestClose={() => {\r\n                if (closeOnPressBack) _setModalVisible(false);\r\n            }}\r\n        >\r\n            <KeyboardAvoidingView\r\n                enabled={keyboardAvoidingViewEnabled}\r\n                behavior=\"padding\"\r\n                style={[\r\n                    {\r\n                        flex: 1,\r\n                        backgroundColor: \"#00000077\",\r\n                    },\r\n                    customStyles.wrapper,\r\n                ]}\r\n            >\r\n                <Animated.View\r\n                    {...(!dragFromTopOnly && panResponder.current?.panHandlers ? panResponder.current.panHandlers : {} )}\r\n                    style={[\r\n                        panStyle,\r\n                        {\r\n                            backgroundColor: \"#fff\",\r\n                            width: \"100%\",\r\n                            height: WindowHeight,\r\n                            overflow: \"hidden\"\r\n                        },\r\n                        customStyles.container\r\n                    ]}\r\n                >\r\n                    {closeOnDragDown && (\r\n                        <View\r\n                            {...(dragFromTopOnly && panResponder.current?.panHandlers ? panResponder.current.panHandlers : {} )}\r\n                            style={{\r\n                                width: \"100%\",\r\n                                alignItems: \"center\",\r\n                                backgroundColor: \"transparent\"\r\n                            }}\r\n                        >\r\n                            <View style={[\r\n                                {\r\n                                    width: 35,\r\n                                    height: 5,\r\n                                    borderRadius: 5,\r\n                                    margin: 10,\r\n                                    backgroundColor: \"#ccc\",\r\n                                },\r\n                                customStyles.draggableIcon,\r\n                            ]} />\r\n                        </View>\r\n                    )}\r\n                    {children}\r\n                </Animated.View>\r\n            </KeyboardAvoidingView>\r\n        </RNModal>\r\n    );\r\n};\r\n\r\nFullscreenModal.defaultProps = defaultProps;\r\n\r\nexport default FullscreenModal;\r\n"]}